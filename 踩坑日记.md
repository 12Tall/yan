# 踩坑日记  
记录一些开发过程中遇到的问题与解决方案  

##  指定Webview 版本  
1. 在[webview2官网](https://developer.microsoft.com/en-us/microsoft-edge/webview2/#download-section)下载`.cab`文件  
2. 解压`.cab`文件到指定文件夹：`expand xyz.cab -f:* D:\code\yan\wv2`  
```rust
// 在rust 代码中调用
env::set_var(
    "WEBVIEW2_BROWSER_EXECUTABLE_FOLDER",
    "D:\\code\\yan\\wv2",
);
```

## 指定user_data_directory
不能通过环境变量指定`user_data_directory`，但是可以通过设置`WebContext`来实现。  
```rust
let mut user_data_dir = PathBuf::from(env::var("appdata").unwrap());
user_data_dir.push("yan");
let mut webctx = WebContext::new(Some(user_data_dir));
let mut web = web
    .with_rpc_handler(handler)
    .with_web_context(&mut webctx)
    .build()
    .unwrap();
```

## include_bytes!
`include_bytes!`宏可以直接将文件引用为二进制的形式，但由于是宏命令，所以文件路径的相对起始位置应该是代码文件所在的目录。  
```rust
let by:&[u8,0] = include_bytes!("../res/logo128.ico");
```
而`include_dir`宏的起始目录则是项目的根目录。

## 以二进制形式读取文件  
通过`std::fs::File`可以以二进制的形式读取文件，但是不够灵活，更好的方案是通过`nom`或者`byteorder`库来实现  
```rust
use byteorder::{BigEndian, LittleEndian, ReadBytesExt};
use std::io::Read;
use std::{fs::File, mem};

// representation 描述、表示
// packaged 表示紧密排列
#[repr(C, packed)]
#[derive(Debug)]
struct DosHeader {
    magic: [u8; 2],
}
fn main() {
    let mut pe = File::open("yan.exe").unwrap();
    // 在堆上初始化结构
    let mut dh = unsafe { mem::zeroed::<DosHeader>() };
    pe.read_exact(&mut dh.magic);    
    println!("{:X?}{:X?}", dh.magic[0] as char, dh.magic[1] as char);
    // 注意读取的时候有大小端字节序的区别
    let uint16 = pe.read_u16::<LittleEndian>().unwrap();
    println!("{}",uint16);
}
```
